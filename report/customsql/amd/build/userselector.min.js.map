{"version":3,"sources":["../src/userselector.js"],"names":["selector","results","map","user","value","id","label","_label","transport","query","success","failure","Ajax","call","methodname","args","capability","document","getElementById","then","Promise","all","Templates","render","html","catch"],"mappings":"8LAkEO,SAAwBA,CAAxB,CAAkCC,CAAlC,CAA2C,CAC9C,MAAOA,CAAAA,CAAO,CAACC,GAAR,CAAY,SAACC,CAAD,CAAU,CACzB,MAAO,CACHC,KAAK,CAAED,CAAI,CAACE,EADT,CAEHC,KAAK,CAAEH,CAAI,CAACI,MAFT,CAIV,CALM,CAMV,C,CAjDD,OACA,O,mDAUO,QAASC,CAAAA,CAAT,CAAmBR,CAAnB,CAA6BS,CAA7B,CAAoCC,CAApC,CAA6CC,CAA7C,CAAsD,CACzDC,UAAKC,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,4BADL,CAEPC,IAAI,CAAE,CACFN,KAAK,CAAEA,CADL,CAEFO,UAAU,CAAEC,QAAQ,CAACC,cAAT,CAAwB,eAAxB,EAAyCd,KAFnD,CAFC,CAAD,CAAV,EAMI,CANJ,EAQCe,IARD,CAQM,SAAClB,CAAD,CAAa,CAEf,MAAOmB,CAAAA,OAAO,CAACC,GAAR,CAAYpB,CAAO,CAACC,GAAR,CAAY,SAACC,CAAD,CAAU,CACrC,MAAOmB,WAAUC,MAAV,CAAiB,gDAAjB,CAAmEpB,CAAnE,EACFgB,IADE,CACG,SAACK,CAAD,CAAU,CACZrB,CAAI,CAACI,MAAL,CAAciB,CAAd,CACA,MAAOrB,CAAAA,CACV,CAJE,CAKV,CANkB,CAAZ,CAOV,CAjBD,EAmBCgB,IAnBD,CAmBMT,CAnBN,EAoBCe,KApBD,CAoBOd,CApBP,CAqBH,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript module to work with the auto-complete of users.\n *\n * @module     report_customsql/userselector\n * @package    report_customsql\n * @copyright  2020 The Open University\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\n\n/**\n * Source of data for Ajax element.\n *\n * @param {String} selector The selector of the auto complete element.\n * @param {String} query The query string.\n * @param {Function} success To be called with the results, when received.\n * @param {Function} failure To be called with any errors.\n */\nexport function transport(selector, query, success, failure) {\n    Ajax.call([{\n        methodname: 'report_customsql_get_users',\n        args: {\n            query: query,\n            capability: document.getElementById('id_capability').value\n        }\n    }])[0]\n\n    .then((results) => {\n        // For each user in the result, render the display, and set it on the _label field.\n        return Promise.all(results.map((user) => {\n            return Templates.render('report_customsql/form-user-selector-suggestion', user)\n                .then((html) => {\n                    user._label = html;\n                    return user;\n                });\n        }));\n    })\n\n    .then(success)\n    .catch(failure);\n}\n\n/**\n * Process the results for auto complete elements.\n *\n * @param {String} selector The selector of the auto complete element.\n * @param {Array} results An array or results.\n * @return {Array} New array of results.\n */\nexport function processResults(selector, results) {\n    return results.map((user) => {\n        return {\n            value: user.id,\n            label: user._label\n        };\n    });\n}\n"],"file":"userselector.min.js"}